<%# app/views/founder_onboarding/show.html.erb %>
<% steps = [
  { key: 'personal', label: 'Personal' },
  { key: 'startup', label: 'Startup' },
  { key: 'professional', label: 'Professional' },
  { key: 'mentorship', label: 'Mentorship' },
  { key: 'confirm', label: 'Confirm' }
] %>
<div class="max-w-2xl mx-auto mt-10 bg-white rounded-lg shadow-lg p-8">
  <!-- Step Indicator and Progress Bar -->
  <% step_index = steps.index { |s| s[:key] == @step } || 0 %>
  <% percent_complete = ((step_index + 1).to_f / steps.size * 100).round %>
  <div class="mb-8">
    <div class="flex justify-between items-center mb-4">
      <span class="text-sm font-medium text-gray-700">Step <%= step_index + 1 %> of <%= steps.size %></span>
      <span class="text-sm text-gray-500"><%= percent_complete %>% complete</span>
    </div>
    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
      <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: <%= percent_complete %>%"></div>
    </div>
  </div>
  <%= form_with url: founder_onboarding_path(step: @step), method: :put, local: true, scope: 'founder_onboarding', html: { multipart: true, novalidate: true, id: 'founder-onboarding-form' } do |f| %>
    <% if @errors.present? %>
      <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded">
        <h4 class="text-red-800 font-semibold mb-2">Please fix the following before continuing:</h4>
        <ul class="list-disc list-inside text-sm text-red-700">
          <% Array(@errors).each do |err| %>
            <li><%= err %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <% if @step == 'personal' %>
      <h2 class="text-2xl font-semibold mb-6">Founder Personal Information</h2>
      <%= f.fields_for :user_profile, @user_profile do |up| %>
        <div class="grid grid-cols-1 gap-4">
          <div>
            <%= up.label :full_name, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= up.text_field :full_name, required: true, aria: { required: true }, placeholder: 'Enter your full name', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <%# Only show email if current_user is present %>
          <% if current_user %>
            <div>
              <%= label_tag :email, 'Email', class: 'block text-sm font-medium mb-1' %>
              <%= text_field_tag :email, current_user.email, class: 'input input-bordered w-full', readonly: true, aria: { readonly: true } %>
            </div>
          <% end %>
          <div>
            <%= up.label :phone, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= up.telephone_field :phone, required: true, aria: { required: true }, placeholder: 'Enter your phone number', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= up.label :country, 'Country', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= up.select :country, country_list, { prompt: 'Select country' }, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= up.label :city, 'City', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= up.text_field :city, aria: { describedby: 'city-help' }, placeholder: 'Enter your city name', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
            <small id="city-help" class="text-gray-500">Enter your city name</small>
          </div>
          <div>
            <div id="photo-dropzone" class="mb-4 border-2 border-dashed rounded-lg p-6 text-center text-gray-600 bg-white">
                <%= file_field_tag 'founder_onboarding[user_profile][photo]', id: 'founder_profile_photo_input', accept: 'image/png,image/jpeg', class: 'hidden' %>
                <div class="mb-3 flex flex-col items-center justify-center">
                  <% if @user_profile&.photo&.attached? %>
                    <%= image_tag url_for(@user_profile.photo), id: 'founder_profile_photo_preview', class: 'h-28 w-28 rounded-full object-cover mb-3', alt: 'Profile photo preview', style: 'display: inline-block;' %>
                  <% else %>
                    <img id="founder_profile_photo_preview" src="" alt="Profile photo preview" class="hidden h-28 w-28 rounded-full object-cover mb-3" style="display:none;" />
                  <% end %>
                  <svg id="photo-upload-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400 mb-3 <%= @user_profile&.photo&.attached? ? 'hidden' : '' %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16V8a4 4 0 014-4h2a4 4 0 014 4v8M7 16h10M7 16l-2 2m12-2 2 2" />
                  </svg>
                  <p class="font-medium">Choose a file or drag &amp; drop it here</p>
                  <p class="text-sm text-gray-400">JPEG, PNG formats, up to 50MB</p>
                </div>
                <label for="founder_profile_photo_input" class="inline-block mt-2 px-4 py-2 bg-white border border-gray-300 rounded-md cursor-pointer text-sm text-gray-700">Browse File</label>
                <p id="founder_photo_filename" class="mt-2 text-sm text-gray-600"><%= @user_profile&.photo&.attached? ? @user_profile.photo.filename.to_s : '' %></p>
              </div>
              <%= up.label :bio, 'Short professional bio (max 200 words)', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              
              <%= up.text_area :bio, placeholder: 'Founder and product lead building a B2B logistics startup in East Africa, with experience in operations, customer discovery, and scaling early-stage teams.', rows: 5, maxlength: 1200, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
              <script>
                (function(){
                  var drop = document.getElementById('photo-dropzone');
                  var input = document.getElementById('founder_profile_photo_input');
                  var filename = document.getElementById('founder_photo_filename');
                  var preview = document.getElementById('founder_profile_photo_preview');
                  var icon = document.getElementById('photo-upload-icon');
                  var prevUrl = null;
                  if(!drop || !input) return;
                  function showPreview(file){
                    if(!file) return;
                    try{ if(prevUrl) URL.revokeObjectURL(prevUrl); }catch(e){}
                    var url = URL.createObjectURL(file);
                    prevUrl = url;
                    if(preview){
                      preview.src = url;
                      preview.classList.remove('hidden');
                      preview.style.display = 'inline-block';
                      preview.classList.add('rounded-full','object-cover');
                      preview.style.width = '7rem';
                      preview.style.height = '7rem';
                    }
                    if(icon) icon.classList.add('hidden');
                    filename.textContent = file.name;
                  }
                  ['dragenter','dragover'].forEach(function(e){ drop.addEventListener(e,function(ev){ ev.preventDefault(); drop.classList.add('ring-2','ring-teal-400'); }); });
                  ['dragleave','drop'].forEach(function(e){ drop.addEventListener(e,function(ev){ ev.preventDefault(); drop.classList.remove('ring-2','ring-teal-400'); }); });
                  drop.addEventListener('drop', function(ev){
                    ev.preventDefault();
                    var files = ev.dataTransfer.files;
                    if(files && files.length){
                      showPreview(files[0]);
                      try { var dt = new DataTransfer(); dt.items.add(files[0]); input.files = dt.files; } catch(err) { /* ignore */ }
                    }
                  });
                  input.addEventListener('change', function(){ if(input.files && input.files.length) showPreview(input.files[0]); else { if(preview) preview.classList.add('hidden'); if(icon) icon.classList.remove('hidden'); filename.textContent = ''; } });
                })();
              </script>
            <small class="text-gray-500">Briefly describe yourself and your role in the startup.</small>
          </div>
        </div>
      <% end %>
    <% elsif @step == 'startup' %>
      <h2 class="text-2xl font-semibold mb-6">Startup Details</h2>
      <%= f.fields_for :startup_profile, @startup_profile do |sp| %>
        <div class="grid grid-cols-1 gap-4">
          <div>
            <%= sp.label :startup_name, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :startup_name, placeholder: 'Enter your startup name', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :logo, 'Startup logo (JPEG or PNG)', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <div id="logo-dropzone" class="mb-4 border-2 border-dashed rounded-lg p-6 text-center text-gray-600 bg-white">
              <%= sp.file_field :logo, id: 'founder_startup_logo_input', accept: 'image/png,image/jpeg', class: 'hidden' %>
              <div class="mb-3 flex flex-col items-center justify-center">
                <% if @startup_profile&.logo&.attached? %>
                  <%= image_tag url_for(@startup_profile.logo), id: 'founder_startup_logo_preview', class: 'h-28 w-28 rounded-full object-cover mb-3', alt: 'Startup logo preview', style: 'display:inline-block;' %>
                <% else %>
                  <img id="founder_startup_logo_preview" src="" alt="Startup logo preview" class="hidden h-28 w-28 rounded-full object-cover mb-3" style="display:none;" />
                <% end %>
                <svg id="startup-photo-upload-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400 mb-3 <%= @startup_profile&.logo&.attached? ? 'hidden' : '' %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16V8a4 4 0 014-4h2a4 4 0 014 4v8M7 16h10M7 16l-2 2m12-2 2 2" />
                </svg>
                <p class="font-medium">Choose a file or drag &amp; drop it here</p>
                <p class="text-sm text-gray-400">JPEG, PNG formats, up to 50MB</p>
              </div>
              <label for="founder_startup_logo_input" class="inline-block mt-2 px-4 py-2 bg-white border border-gray-300 rounded-md cursor-pointer text-sm text-gray-700">Browse File</label>
              <p id="founder_logo_filename" class="mt-2 text-sm text-gray-600"><%= @startup_profile&.logo&.attached? ? @startup_profile.logo.filename.to_s : '' %></p>
            </div>
            <script>
              (function(){
                var drop = document.getElementById('logo-dropzone');
                var input = document.getElementById('founder_startup_logo_input');
                var filename = document.getElementById('founder_logo_filename');
                var preview = document.getElementById('founder_startup_logo_preview');
                var icon = document.getElementById('startup-photo-upload-icon');
                var prevUrl = null;
                if(!drop || !input) return;
                function showPreview(file){
                  if(!file) return;
                  try{ if(prevUrl) URL.revokeObjectURL(prevUrl); }catch(e){}
                  var url = URL.createObjectURL(file);
                  prevUrl = url;
                  if(preview){ preview.src = url; preview.classList.remove('hidden'); preview.style.display = 'inline-block'; preview.classList.add('rounded-full','object-cover'); preview.style.width = '7rem'; preview.style.height = '7rem'; }
                  if(icon) icon.classList.add('hidden');
                  filename.textContent = file.name;
                }
                ['dragenter','dragover'].forEach(function(e){ drop.addEventListener(e,function(ev){ ev.preventDefault(); drop.classList.add('ring-2','ring-teal-400'); }); });
                ['dragleave','drop'].forEach(function(e){ drop.addEventListener(e,function(ev){ ev.preventDefault(); drop.classList.remove('ring-2','ring-teal-400'); }); });
                drop.addEventListener('drop', function(ev){
                  ev.preventDefault();
                  var files = ev.dataTransfer.files;
                  if(files && files.length){
                    showPreview(files[0]);
                    try { var dt = new DataTransfer(); dt.items.add(files[0]); input.files = dt.files; } catch(err) { /* ignore */ }
                  }
                });
                input.addEventListener('change', function(){ if(input.files && input.files.length) showPreview(input.files[0]); else { if(preview) preview.classList.add('hidden'); if(icon) icon.classList.remove('hidden'); filename.textContent = ''; } });
              })();
            </script>
          </div>
          <div>
            <%= sp.label :website_url, 'Startup website', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.url_field :website_url, placeholder: 'https://', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <%= sp.label :founded_year, 'Year founded', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= sp.number_field :founded_year, min: 1900, max: Date.today.year, placeholder: 'e.g. 2020', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
            <div>
              <%= sp.label :location, 'Country / Market(s) of operation', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= sp.select :location, country_list, { include_blank: 'Select country' }, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
          </div>
          <div>
            <%= sp.label :description, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_area :description, maxlength: 1000, placeholder: 'Provide a concise overview of your business (min 250, max 1000 chars)', rows: 6, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :stage, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.select :stage, (defined?(STAGE_OPTIONS) ? STAGE_OPTIONS : ['Idea', 'Early', 'Growth', 'Scaling', 'Other']), {}, { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' } %>
          </div>
          <div>
            <%= sp.label :target_market, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :target_market, placeholder: 'Who is your target market?', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :value_proposition, 'Unique Value Proposition', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :value_proposition, placeholder: 'What makes your startup unique?', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div class="flex items-start gap-3">
            <%= sp.check_box :profile_visibility, class: 'checkbox checkbox-primary mt-1' %>
            <div>
              <p class="text-sm font-medium text-gray-900">Share this profile with the Nailab community</p>
              <p class="text-sm text-gray-500">Enabling this lets mentors and partners see the public details you have provided.</p>
            </div>
          </div>
          <div class="mt-4">
            <%# Additional actions: invite modal and add another startup link %>
            <div class="flex gap-3 items-center">
              <button type="button" class="btn btn-outline btn-sm" data-action="click->invite-modal#open">+ Invite co-founder / team</button>
              <%= link_to 'Add another startup', founder_onboarding_path(step: 'additional'), class: 'text-sm text-nailab-teal underline' %>
            </div>
            <noscript>
              <div class="mt-2">
                <%= link_to '+ Invite co-founder / team (no JS)', new_founder_startup_invite_path(startup_id: current_user&.startup&.id), class: 'text-sm text-blue-600 underline' %>
              </div>
            </noscript>
          </div>
          <%= render 'founder_onboarding/invite_modal' %>
        </div>
      <% end %>
    <% elsif @step == 'additional' %>
      <h2 class="text-2xl font-semibold mb-6">Add Additional Startup (Optional)</h2>
      <div class="bg-gray-50 rounded-lg p-6">
        <p class="text-sm text-gray-600 mb-4">You can showcase multiple startups. Fill the fields below to add another startup.</p>
        <%= fields_for :additional_startup do |asp| %>
          <div class="grid grid-cols-1 gap-4">
            <div>
              <%= asp.label :startup_name, class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= asp.text_field :startup_name, placeholder: 'Startup name', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
            <div>
              <%= asp.label :website_url, 'Website', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= asp.url_field :website_url, placeholder: 'https://', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
            <div>
              <%= asp.label :description, 'Brief description', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= asp.text_area :description, rows: 4, minlength: 100, maxlength: 1000, placeholder: 'Short description of this startup', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
            <div>
              <%= asp.label :team_size, 'Number of team members', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= asp.number_field :team_size, min: 1, placeholder: 'e.g. 5', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
            <div>
              <%= asp.label :value_proposition, 'Unique Value Proposition', class: 'block text-sm font-medium text-gray-700 mb-2' %>
              <%= asp.text_area :value_proposition, rows: 3, minlength: 50, maxlength: 1000, placeholder: 'What makes this startup unique?', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' %>
            </div>
          </div>
        <% end %>
      </div>
    <% elsif @step == 'professional' %>
      <h2 class="text-2xl font-semibold mb-6">Professional Background</h2>
      <%= f.fields_for :startup_profile, @startup_profile do |sp| %>
        <div class="grid grid-cols-1 gap-4">
          <div>
            <%= sp.label :sector, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :sector, placeholder: 'Industry sector', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :stage, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :stage, placeholder: 'Startup stage', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :funding_stage, 'Funding Stage', class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_field :funding_stage, placeholder: 'e.g. Seed, Series A', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :funding_raised, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.number_field :funding_raised, placeholder: 'Amount raised (USD)', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
        </div>
      <% end %>
    <% elsif @step == 'mentorship' %>
      <h2 class="text-2xl font-semibold mb-6">Mentorship & Challenges</h2>
      <%= f.fields_for :startup_profile, @startup_profile do |sp| %>
        <div class="grid grid-cols-1 gap-4">
          <div>
            <%= sp.label :mentorship_areas, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.select :mentorship_areas, ['Product', 'Go-to-market', 'Fundraising', 'Team', 'Other'], {}, { multiple: true, required: true, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' } %>
          </div>
          <div>
            <%= sp.label :challenge_details, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.text_area :challenge_details, placeholder: 'Describe your main challenges', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' %>
          </div>
          <div>
            <%= sp.label :preferred_mentorship_mode, class: 'block text-sm font-medium text-gray-700 mb-2' %>
            <%= sp.select :preferred_mentorship_mode, ['One-on-one', 'Group', 'Virtual', 'In-person', 'Other'], {}, { required: true, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent' } %>
          </div>
        </div>
      <% end %>
    <% elsif @step == 'confirm' %>
      <h2 class="text-2xl font-semibold mb-6">Review & Confirm</h2>
      <p class="mb-4">Please review your details before submitting.</p>

      <div class="space-y-8">
        <!-- Founder Profile -->
        <div class="bg-gray-50 rounded-lg p-6">
          <div class="flex justify-between items-start mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Founder Profile</h3>
            <%= link_to founder_onboarding_path(step: 'personal'), class: 'text-nailab-teal hover:text-nailab-teal text-sm' do %>
              <i class="fas fa-edit mr-1"></i> Edit
            <% end %>
          </div>
          <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Name:</dt>
              <dd class="text-sm text-gray-900"><%= @user_profile.full_name || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Email:</dt>
              <dd class="text-sm text-gray-900"><%= @user_profile.user&.email || current_user&.email || session.dig(:founder_onboarding_user_profile, :email) || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Phone:</dt>
              <dd class="text-sm text-gray-900"><%= @user_profile.phone || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Country:</dt>
              <dd class="text-sm text-gray-900"><%= @user_profile.country || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">City:</dt>
              <dd class="text-sm text-gray-900"><%= @user_profile.city || 'Not provided' %></dd>
            </div>
          </dl>
        </div>

        <!-- Startup Profile -->
        <div class="bg-gray-50 rounded-lg p-6">
          <div class="flex justify-between items-start mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Startup Profile</h3>
            <%= link_to founder_onboarding_path(step: 'startup'), class: 'text-nailab-teal hover:text-nailab-teal text-sm' do %>
              <i class="fas fa-edit mr-1"></i> Edit
            <% end %>
          </div>
          <% if @startup_profile&.logo&.attached? %>
            <div class="mb-4">
              <%= image_tag url_for(@startup_profile.logo), alt: 'Startup logo', class: 'h-24 w-24 rounded-full object-cover' %>
            </div>
          <% end %>
          <dl class="space-y-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Startup Name:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.startup_name || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Description:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.description || 'Not provided' %></dd>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <dt class="text-sm font-medium text-gray-500">Stage:</dt>
                <dd class="text-sm text-gray-900"><%= @startup_profile&.stage || 'Not provided' %></dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">Target Market:</dt>
                <dd class="text-sm text-gray-900"><%= @startup_profile&.target_market || 'Not provided' %></dd>
              </div>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Unique Value Proposition:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.value_proposition || 'Not provided' %></dd>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <dt class="text-sm font-medium text-gray-500">Sector:</dt>
                <dd class="text-sm text-gray-900"><%= @startup_profile&.sector || 'Not provided' %></dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">Funding Stage:</dt>
                <dd class="text-sm text-gray-900"><%= @startup_profile&.funding_stage || 'Not provided' %></dd>
              </div>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Funding Raised:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.funding_raised || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Mentorship Areas:</dt>
              <dd class="text-sm text-gray-900"><%= Array(@startup_profile&.mentorship_areas).join(', ').presence || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Challenge Details:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.challenge_details || 'Not provided' %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Preferred Mentorship Mode:</dt>
              <dd class="text-sm text-gray-900"><%= @startup_profile&.preferred_mentorship_mode || 'Not provided' %></dd>
            </div>
          </dl>
        </div>
      </div>

      <% unless current_user %>
        <div class="mt-8 p-6 bg-teal-50 rounded-lg text-center">
          <h3 class="text-xl font-bold mb-2 text-nailab-teal">Thank you for completing the onboarding form!</h3>
          <p class="mb-4 text-gray-700">To finish, please create an account. You will receive a confirmation email after registration.</p>
          <%= link_to 'Create Account', new_founder_registration_path, class: 'btn btn-primary bg-nailab-teal hover:bg-nailab-teal text-white px-8 py-3 rounded-lg font-semibold shadow-lg' %>
        </div>
      <% end %>
    <% end %>
    <div class="flex justify-between mt-8">
      <% current_index = steps.index { |s| s[:key] == @step } %>
      <% if current_index && current_index > 0 %>
        <%= link_to 'Back', founder_onboarding_path(step: steps[current_index - 1][:key]), class: 'btn btn-outline btn-secondary' %>
      <% else %>
        <span></span>
      <% end %>
      <div class="flex gap-4">
        <%= button_tag type: 'submit', formaction: founder_onboarding_save_and_exit_path(step: @step), formmethod: 'patch',
                       class: "btn btn-outline border-gray-300 text-gray-700 hover:bg-gray-50 px-6 py-3 rounded-lg font-semibold" do %>
          <i class="fas fa-save mr-2"></i> Save & Exit
        <% end %>
        <%# Add Skip button for optional steps %>
        <% optional_steps = %w[additional invite_cofounders invite_team professional mentorship] %>
        <% all_steps = Onboarding::FoundersAdapter::STEPS %>
        <% if optional_steps.include?(@step) && all_steps %>
          <% idx = all_steps.index(@step) %>
          <% next_step = all_steps[idx + 1] if idx && idx + 1 < all_steps.size %>
          <% if next_step %>
            <%= link_to 'Skip', founder_onboarding_path(step: next_step), class: 'btn btn-outline border-gray-300 text-gray-700 hover:bg-gray-50 px-6 py-3 rounded-lg font-semibold' %>
          <% end %>
        <% end %>
        <% if @step == 'confirm' %>
          <% if current_user %>
            <%= f.submit 'Finish', class: 'btn btn-primary bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-lg font-semibold shadow-lg' %>
          <% end %>
        <% else %>
          <%= f.submit 'Next', id: 'onboarding-next-btn', form: 'founder-onboarding-form', class: 'btn btn-primary bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-lg font-semibold shadow-lg' %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
<script>
  (function(){
    try {
      var next = document.getElementById('onboarding-next-btn');
      if(!next) return;
      var form = next.form || (next.closest ? next.closest('form') : null);
      next.addEventListener('click', function(e){
        try{ console.log('Onboarding: Next clicked â€” attempting submit for step', '<%= j @step %>'); }catch(e){}
        if(form){
          try{
            if(typeof form.requestSubmit === 'function'){
              form.requestSubmit();
            } else if (typeof form.submit === 'function'){
              form.submit();
            }
          }catch(err){ console.log('submit attempt error', err); try{ form.submit(); }catch(e){} }
        } else {
          console.log('Onboarding: no form found to submit for Next button');
        }
      });
      if(form){
        form.addEventListener('submit', function(){ console.log('Onboarding form submit event fired for step', '<%= j @step %>'); });
      }
    } catch(e) { console.log('Onboarding debug handler error', e); }
  })();
</script>
<!-- Save & Exit now submits the main multipart form directly so file inputs are included -->
