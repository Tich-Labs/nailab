<%# Shared resource card partial - accepts `resource` and optional `variant` ('founder' or 'public') %>
<% variant ||= 'public' %>

<article class="relative flex flex-col justify-between rounded-2xl border border-base-200 bg-white p-6 shadow-lg transition hover:border-base-300">
  <%# Compute action label and path based on resource_type so CTAs are consistent %>
  <% rt = resource.resource_type.to_s.downcase %>
  <% action_map = {
    'blog' => { label: 'Read', path: ->(r) { resource_detail_path(r.slug) } },
    'article' => { label: 'Read', path: ->(r) { resource_detail_path(r.slug) } },
    'template' => { label: 'Download', path: ->(r) { r.url.presence || (variant == 'founder' ? download_founder_resource_path(r) : resource_detail_path(r.slug)) } },
    'opportunity' => { label: 'Apply', path: ->(r) { r.url.presence || resource_detail_path(r.slug) } },
    'event' => { label: 'Attend', path: ->(r) { r.url.presence || resource_detail_path(r.slug) } }
  } %>
  <% default_action = { label: 'View', path: ->(r) { resource_detail_path(r.slug) } } %>
  <% action = action_map.fetch(rt, default_action) %>

  <% if variant == 'founder' %>
    <div class="bg-white px-4 py-3 -mx-6 mt-0 border-b border-nailab-teal/30">
      <div class="flex items-center justify-between">
        <span class="px-3 py-1 bg-nailab-teal/10 text-nailab-teal text-s font-semibold rounded"><%= resource.respond_to?(:category) ? resource.category : resource.resource_type&.capitalize %></span>
        <div class="flex items-center gap-2">
          <% if defined?(@bookmarked_ids) && @bookmarked_ids.include?(resource.id) %>
            <span class="bg-nailab-purple rounded-full p-1" title="Bookmarked">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20">
                <path fill="#fff" d="M5 3a2 2 0 0 0-2 2v12a1 1 0 0 0 1.447.894L10 16.118l5.553 1.776A1 1 0 0 0 17 17V5a2 2 0 0 0-2-2H5zm0 2h10v11.382l-4.553-1.455a1 1 0 0 0-.894 0L5 16.382V5z"/>
              </svg>
            </span>
          <% end %>
          <% if resource.respond_to?(:published_at) && resource.published_at.present? %>
            <span class="text-nailab-teal text-sm font-medium"><%= resource.published_at.strftime('%b %d, %Y') %></span>
          <% else %>
            <span class="text-nailab-teal text-sm font-medium"><%= resource.respond_to?(:file_type) ? resource.file_type : (resource.file_type || '') %></span>
          <% end %>
          <%# Only show the bookmark icon, not the button, for founder cards %>
        </div>
      </div>
    </div>
    <header class="space-y-3 p-6">
      <h3 class="text-xl font-semibold text-black">
        <%= link_to resource.title, resource_detail_path(resource.slug, return_to: request.fullpath), class: "hover:underline" %>
      </h3>
      <p class="text-sm text-base-content/70"><%= truncate(resource.description, length: 180) %></p>
    </header>
    <div class="px-6 pb-6 flex items-center justify-between text-sm font-semibold text-base-content">
      <% primary_label = action[:label] %>
      <% primary_path = action[:path].call(resource) rescue founder_resource_path(resource) %>
      <% details_path = (begin; founder_resource_path(resource) rescue nil; end) %>
      <% if primary_label == 'Download' %>
        <div class="flex gap-3 w-full">
          <%= link_to primary_path, class: "flex-1 inline-flex items-center justify-center px-4 py-3 text-nailab-teal border border-nailab-teal bg-white rounded-lg hover:bg-nailab-teal/10 transition-all" do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4" /></svg>
            Download
          <% end %>
          <%= link_to 'Details', details_path || founder_resource_path(resource), class: "flex-1 inline-flex items-center justify-center px-4 py-3 bg-nailab-teal text-white text-sm font-semibold rounded-lg hover:bg-nailab-teal/90 transition-all" %>
        </div>
      <% else %>
        <%= link_to primary_label, primary_path, class: "w-full inline-flex items-center justify-center px-4 py-3 bg-nailab-teal text-white text-sm font-semibold rounded-lg hover:bg-nailab-teal/90 transition-all" %>
      <% end %>
    </div>
  <% else %>
    <header class="space-y-3">
      <div class="flex items-center justify-between text-xs uppercase tracking-[0.3em] text-base-content/60">
        <span><%= resource.resource_type&.capitalize %></span>
        <% premium_titles = [
          "Scaling Your African Startup: A Fireside Chat with Flutterwave Founders",
          "Fundraising Checklist: From Seed to Series A",
          "Building Scalable Startups in Africa: Lessons from Flutterwave",
          "Google for Startups Founders Funds - Africa 2025"
        ] %>
        <% if premium_titles.include?(resource.title) %>
          <span class="absolute -top-3 left-4 bg-yellow-200 text-yellow-800 text-xs font-bold px-3 py-1 rounded shadow-sm">Premium Content</span>
        <% end %>
        <% if resource.published_at %>
          <span><%= resource.published_at.strftime('%b %d, %Y') %></span>
        <% end %>
      </div>
      <h3 class="text-xl font-semibold text-base-content"><%= resource.title %></h3>
      <p class="text-sm text-base-content/70"><%= truncate(resource.description, length: 180) %></p>
    </header>
    <div class="mt-6 flex items-center justify-between text-sm font-semibold text-base-content">
      <%= render partial: 'shared/bookmark_button', locals: { resource: resource } %>
      <% public_label = action[:label] %>
      <% public_path = action[:path].call(resource) rescue resource_detail_path(resource.slug) %>
      <%# If the primary public path is the same as the resource detail, label the details link with the primary label and avoid a duplicate span. %>
        <% if public_path.to_s == resource_detail_path(resource.slug).to_s %>
          <%= link_to public_label, resource_detail_path(resource.slug), class: 'link link-hover', data: { controller: 'require-signup', 'require-signup-signed-in-value': user_signed_in?, action: 'click->require-signup#maybeBlock' } %>
        <% else %>
          <%= link_to 'View details', resource_detail_path(resource.slug), class: 'link link-hover', data: { controller: 'require-signup', 'require-signup-signed-in-value': user_signed_in?, action: 'click->require-signup#maybeBlock' } %>
          <%= link_to public_label, public_path, class: 'text-xs uppercase tracking-[0.3em] text-base-content/50 link link-hover', data: { controller: 'require-signup', 'require-signup-signed-in-value': user_signed_in?, action: 'click->require-signup#maybeBlock' } %>
        <% end %>
    </div>
  <% end %>
</article>
