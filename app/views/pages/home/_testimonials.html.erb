<%# _testimonials.html.erb - Testimonials %>
<section class="py-20 bg-white">
  <div class="max-w-4xl mx-auto px-4 text-center">
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var el = document.querySelector('.swiper');
        if (!el) return;
        // Avoid double-initialization when other scripts/controllers also initialize Swiper
        if (el.dataset.swiperInitialized) return;
        new Swiper(el, {
          loop: true,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          slidesPerView: 1,
          autoHeight: true,
        });
        el.dataset.swiperInitialized = 'true';
      });
    </script>
    <h2 class="text-3xl lg:text-5xl font-bold text-gray-900 mb-10">Testimonials</h2>
    <div class="swiper relative pb-20">
      <div class="swiper-wrapper">
        <% @testimonials.each do |testimonial| %>
          <div class="swiper-slide flex flex-col items-center justify-center px-4 py-8 border border-gray-200 rounded-2xl shadow-sm">
            <div class="text-nailab-purple text-3xl mb-4"><i class="fas fa-quote-left"></i></div>
            <p class="italic text-xl md:text-2xl text-gray-900 font-medium mb-8 max-w-3xl mx-auto">"<%= testimonial.quote %>"</p>
            <% if testimonial.photo_url.present? %>
              <img src="<%= testimonial.photo_url %>" alt="<%= testimonial.author_name %>" class="w-20 h-20 rounded-full mx-auto mb-4 border-4 border-white shadow-lg object-cover" />
            <% end %>
            <div class="font-bold text-lg text-gray-900"><%= testimonial.author_name %></div>
            <div class="text-nailab-purple text-base font-medium mb-2"><%= testimonial.author_role %><% if testimonial.organization.present? %>, <%= testimonial.organization %><% end %></div>
            <% if testimonial.website_url.present? %>
              <a href="<%= testimonial.website_url %>" target="_blank" class="text-sm text-blue-500 hover:underline">Learn More: <%= URI.parse(testimonial.website_url).host.sub(/^www\./, '') rescue testimonial.website_url %></a>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="swiper-pagination mt-8"></div>
      <style>
        .swiper-pagination-bullet {
          background: #7c3aed !important;
          opacity: 0.5;
        }
        .swiper-pagination-bullet-active {
          background: #7c3aed !important;
          opacity: 1;
        }
      </style>
      <div class="swiper-button-prev !absolute !left-4 md:!left-12 top-1/2 -translate-y-1/3 !z-10 !bg-nailab-purple hover:!bg-nailab-purple !text-white !w-8 !h-8 md:!w-10 md:!h-10 rounded-full flex items-center justify-center shadow-xl cursor-pointer transition-all">
        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      </div>

      <div class="swiper-button-next !absolute !right-4 md:!right-12 top-1/2 -translate-y-1/3 !z-10 !bg-nailab-purple hover:!bg-nailab-purple !text-white !w-8 !h-8 md:!w-10 md:!h-10 rounded-full flex items-center justify-center shadow-xl cursor-pointer transition-all">
        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 5l7 7-7 7"/>
        </svg>
      </div>
  </div>
</section>