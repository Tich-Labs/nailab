<div class="bg-white p-4 rounded shadow">
	<%= form_with url: admin_about_section_update_path(section: 'why_nailab_exists'), method: :patch, local: true do |form| %>
		<p class="text-sm text-slate-600 mb-4">Update content for the Why Nailab Exists section. Enter multiple paragraphs separated by a blank line.</p>
		<div class="mb-3">
			<%= label_tag 'section_payload[title]', 'Title', class: 'block font-bold text-black' %>
			<%= text_field_tag 'section_payload[title]', @section_content["title"], class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
		</div>

		<div class="mb-3">
			<%= label_tag 'section_payload[description]', 'Content (you can paste multiple paragraphs)', class: 'block font-bold text-black' %>
			<% description_value = if @section_content["paragraph_one"].present?
															 parts = [@section_content["paragraph_one"], @section_content["paragraph_two"], @section_content["paragraph_three"]].compact.join("\n\n")
														 elsif @section_content["description"].present?
															 @section_content["description"]
														 else
															 ""
														 end %>
			<%= text_area_tag 'section_payload[description]', description_value, rows: 10, class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
		</div>

		<div class="flex gap-3">
			<%= form.submit 'Save section', class: 'btn btn-success text-white font-bold' %>
			<!-- Fallback explicit button in case form builder output is hidden by CSS/JS -->
			<button type="submit" class="btn btn-success text-white font-bold" style="display:inline-block !important; visibility:visible !important; opacity:1 !important;">Save section</button>
		</div>
	<% end %>
</div>
<script>
	// Ensure submit controls in this admin partial are visible even if CSS/JS hides them
	document.addEventListener('DOMContentLoaded', function() {
		try {
			var containers = document.querySelectorAll('.bg-white.p-4.rounded.shadow');
			containers.forEach(function(container) {
				var form = container.querySelector('form');
				if (!form) return;
				// Unhide any action containers
				form.querySelectorAll('.actions, .form-actions').forEach(function(a){
					a.style.display = 'block';
					a.style.visibility = 'visible';
					a.style.opacity = '1';
				});
				// Unhide submit inputs/buttons
				form.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(function(btn){
					btn.style.display = 'inline-block';
					btn.style.visibility = 'visible';
					btn.style.opacity = '1';
					btn.classList.remove('hidden');
					btn.removeAttribute('aria-hidden');
					btn.disabled = false;
				});
			});
		} catch (e) {
			// fail silently
			console && console.error && console.error('unhide admin submit error', e);
		}
	});
</script>
<script>
	// Live update the preview as the editor types
	document.addEventListener('DOMContentLoaded', function() {
		var titleInput = document.querySelector('input[name="section_payload[title]"]');
		var descInput = document.querySelector('textarea[name="section_payload[description]"]');
		var previewTitle = document.getElementById('admin_preview_why_title');
		var previewContent = document.getElementById('admin_preview_why_content');

		function escapeHtml(s) {
			return (s||'').toString()
				.replace(/&/g,'&amp;')
				.replace(/</g,'&lt;')
				.replace(/>/g,'&gt;')
				.replace(/"/g,'&quot;')
				.replace(/'/g,'&#039;');
		}

		function buildPreview() {
			if (previewTitle && titleInput) previewTitle.textContent = titleInput.value || 'Why Nailab Exists';
			if (!previewContent || !descInput) return;
			var parts = descInput.value.split(/\r?\n\r?\n+/).map(function(p){ return p.trim(); }).filter(Boolean);
			if (parts.length === 0) {
				previewContent.innerHTML = '';
				return;
			}
			previewContent.innerHTML = parts.map(function(p){ return '<p>'+escapeHtml(p)+'</p>'; }).join('');
		}

		if (titleInput) titleInput.addEventListener('input', buildPreview);
		if (descInput) descInput.addEventListener('input', buildPreview);
	});
</script>
