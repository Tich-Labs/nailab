<%# Shared partial for About section edit forms - following Homepage patterns %>
<div class="mb-4">
  <%= link_to 'Preview live section', local_assigns[:preview_url], class: 'btn btn-secondary', target: '_blank', rel: 'noopener' %>
</div>
<div class="bg-white p-4 rounded shadow">
  <%= form_with url: local_assigns[:form_url], method: :patch, local: true do |form| %>
    <p class="text-sm text-slate-600 mb-4">Update content for Our Impact section.</p>
    <div class="mb-3">
      <%= label_tag 'section_payload[title]', 'Title', class: 'block font-bold text-black' %>
      <%= text_field_tag 'section_payload[title]', local_assigns[:section_content]["title"], class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
    </div>
    <div class="mb-3">
      <%= label_tag 'section_payload[description]', 'Description', class: 'block font-bold text-black' %>
      <% 
        # Priority: description first, then paragraph_one as fallback, then empty string
        description_value = if local_assigns[:section_content]["description"].present?
                           local_assigns[:section_content]["description"]
                         elsif local_assigns[:section_content]["paragraph_one"].present?
                           local_assigns[:section_content]["paragraph_one"]
                         else
                           ""
                         end
      %>
      <%= text_area_tag 'section_payload[description]', description_value, rows: 6, class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
    </div>
    <% if local_assigns[:stats] %>
      <div class="mb-4">
        <p class="text-sm font-medium mb-2">Impact Stats</p>
        <div class="space-y-2">
          <% local_assigns[:stats].each_with_index do |stat, idx| %>
            <div class="grid grid-cols-2 gap-3">
                <%= text_field_tag 'section_payload[stats][][value]', stat[:value] || stat["value"], placeholder: 'Value (e.g. 10+)', class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
              <%= text_field_tag 'section_payload[stats][][label]', stat[:label] || stat["label"], placeholder: 'Label (e.g. Years of Impact)', class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <div class="flex gap-3 actions form-actions">
      <%= form.submit 'Save section', class: 'btn btn-success text-black font-bold' %>
      <!-- Fallback explicit button in case form builder output is hidden by CSS/JS -->
      <button type="submit" class="btn btn-success text-black font-bold" style="display:inline-block !important; visibility:visible !important; opacity:1 !important;">Save section</button>
    </div>
  <% end %>

  <script>
    // Ensure submit controls in this admin partial are visible even if CSS/JS hides them
    document.addEventListener('DOMContentLoaded', function() {
      try {
        var containers = document.querySelectorAll('.bg-white.p-4.rounded.shadow');
        containers.forEach(function(container) {
          var form = container.querySelector('form');
          if (!form) return;
          // Unhide any action containers
          form.querySelectorAll('.actions, .form-actions').forEach(function(a){
            a.style.display = 'block';
            a.style.visibility = 'visible';
            a.style.opacity = '1';
          });
          // Unhide submit inputs/buttons
          form.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(function(btn){
            btn.style.display = 'inline-block';
            btn.style.visibility = 'visible';
            btn.style.opacity = '1';
            btn.classList.remove('hidden');
            btn.removeAttribute('aria-hidden');
            btn.disabled = false;
          });
        });
      } catch (e) {
        // fail silently
        console && console.error && console.error('unhide admin submit error', e);
      }
    });
  </script>

</div>

