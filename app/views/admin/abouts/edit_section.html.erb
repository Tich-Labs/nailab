<h1 class="text-2xl font-bold mb-4">Edit: <%= @section_title %></h1>

<div class="grid grid-cols-2 gap-8 mb-6">
  <div>
    <h2 class="font-semibold mb-3">Editor</h2>
    <div class="bg-white p-4 rounded shadow">
      <%= form_with url: admin_about_section_update_path(section: @section_key), method: :patch, local: true, html: { multipart: true } do %>
        <p class="text-sm text-slate-600 mb-4">Edit the <%= @section_title %> section content.</p>
        <div class="mb-3">
          <%= label_tag "section[title]", 'Title', class: 'block font-medium' %>
          <%= text_field_tag 'section_payload[title]', (@section_content && (@section_content['title'] || @section_content[:title])), class: 'w-full form-input admin-form-input' %>
        </div>
        <div class="mb-3">
          <%= label_tag "section[description]", 'Description', class: 'block font-medium' %>
          <%= text_area_tag 'section_payload[description]', (@section_content && (@section_content['description'] || @section_content[:description])), class: 'w-full form-input admin-form-input', rows: 3 %>
        </div>
        <h3 class="font-semibold mt-6 mb-2">Stats / Cards</h3>
        <div id="stats-fields" class="space-y-4">
          <% stats = (@section_content && (@section_content['stats'] || @section_content[:stats])) || [
            { value: "10+", label: "Years of Impact" },
            { value: "54", label: "African Countries" },
            { value: "30+", label: "Innovation Programs" },
            { value: "$100M", label: "Funding Facilitated" },
            { value: "1000", label: "Startups Supported" },
            { value: "50+", label: "Partners" }
          ] %>
          <% 6.times do |i| %>
            <div class="p-4 bg-gray-50 rounded-lg shadow">
              <div class="mb-2">
                <%= label_tag "section_payload[stats][#{i}][value]", "Value", class: "block text-sm font-medium text-gray-700" %>
                <%= text_field_tag "section_payload[stats][#{i}][value]", stats[i] && stats[i][:value], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
              </div>
              <div>
                <%= label_tag "section_payload[stats][#{i}][label]", "Label", class: "block text-sm font-medium text-gray-700" %>
                <%= text_field_tag "section_payload[stats][#{i}][label]", stats[i] && stats[i][:label], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
              </div>
            </div>
          <% end %>
        </div>
        <div class="flex gap-3 mt-6">
          <input type="submit" name="commit" value="Save" class="btn btn-primary" data-disable-with="Save">
          <a class="btn btn-secondary" href="/about#<%= @section_key.to_s.tr('_','-') %>">Preview live section</a>
        </div>
      <% end %>
    </div>
  </div>
  <div>
    <h2 class="font-semibold mb-3">Preview</h2>
    <div class="bg-white p-6 rounded shadow space-y-5">
      <% content = @section_content || {} %>
      <div class="space-y-4">
        <h2 class="text-2xl font-bold"><%= content['title'] || content[:title] || @section_title %></h2>
        <% if (content['description'] || content[:description]).present? %>
          <p class="text-sm text-slate-600 font-semibold"><%= content['description'] || content[:description] %></p>
        <% end %>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <% stats = (content['stats'] || content[:stats]) || [] %>
          <% 6.times do |i| %>
            <% stat = stats[i] || {} %>
            <div class="p-4 bg-gray-50 rounded-lg shadow">
              <p class="text-2xl font-bold text-indigo-600"><%= stat[:value] %></p>
              <p class="mt-1 text-sm text-gray-700"><%= stat[:label] %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
