<div class="bg-white p-4 rounded shadow">
	<%= form_with url: admin_about_section_update_path(section: 'why_nailab_exists'), method: :patch, local: true do |form| %>
		<p class="text-sm text-slate-600 mb-4">Update content for the Why Nailab Exists section. Enter multiple paragraphs separated by a blank line.</p>
		<div class="mb-3">
			<%= label_tag 'section_payload[title]', 'Title', class: 'block font-bold text-black' %>
			<%= text_field_tag 'section_payload[title]', @section_content["title"], class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
		</div>

		<div class="mb-3">
			<%= label_tag 'section_payload[description]', 'Content (you can paste multiple paragraphs)', class: 'block font-bold text-black' %>
			<% description_value = if @section_content["paragraph_one"].present?
															 parts = [@section_content["paragraph_one"], @section_content["paragraph_two"], @section_content["paragraph_three"]].compact.join("\n\n")
														 elsif @section_content["description"].present?
															 @section_content["description"]
														 else
															 ""
														 end %>
			<%= text_area_tag 'section_payload[description]', description_value, rows: 10, class: 'w-full form-input admin-form-input bg-white border border-gray-200 shadow-sm rounded-md px-3 py-2' %>
		</div>

		<div class="flex gap-3">
			<%= form.submit 'Save section', class: 'btn btn-success text-white font-bold' %>
		</div>
	<% end %>
</div>
<script>
	// Live update the preview as the editor types
	document.addEventListener('DOMContentLoaded', function() {
		var titleInput = document.querySelector('input[name="section_payload[title]"]');
		var descInput = document.querySelector('textarea[name="section_payload[description]"]');
		var previewTitle = document.getElementById('admin_preview_why_title');
		var previewContent = document.getElementById('admin_preview_why_content');

		function escapeHtml(s) {
			return (s||'').toString()
				.replace(/&/g,'&amp;')
				.replace(/</g,'&lt;')
				.replace(/>/g,'&gt;')
				.replace(/"/g,'&quot;')
				.replace(/'/g,'&#039;');
		}

		function buildPreview() {
			if (previewTitle && titleInput) previewTitle.textContent = titleInput.value || 'Why Nailab Exists';
			if (!previewContent || !descInput) return;
			var parts = descInput.value.split(/\r?\n\r?\n+/).map(function(p){ return p.trim(); }).filter(Boolean);
			if (parts.length === 0) {
				previewContent.innerHTML = '';
				return;
			}
			previewContent.innerHTML = parts.map(function(p){ return '<p>'+escapeHtml(p)+'</p>'; }).join('');
		}

		if (titleInput) titleInput.addEventListener('input', buildPreview);
		if (descInput) descInput.addEventListener('input', buildPreview);
	});
</script>
