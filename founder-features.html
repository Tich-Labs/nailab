<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nailab - Founder Features Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .kanban-column {
            min-height: 400px;
        }
        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card[draggable="true"] {
            cursor: grab;
            user-select: none;
        }
        .feature-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .feature-card.editing {
            outline: 2px solid rgba(59, 130, 246, 0.35);
            outline-offset: 2px;
        }
        .feature-card [contenteditable="true"] {
            outline: none;
        }
        .feature-card .editable:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
            border-radius: 6px;
        }
        .kanban-column.drop-target {
            outline: 2px dashed rgba(0, 0, 0, 0.25);
            outline-offset: 6px;
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        @keyframes dropPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.015); }
            100% { transform: scale(1); }
        }
        .feature-card.just-dropped {
            animation: dropPulse 180ms ease-out;
        }
        .card-meta {
            font-size: 0.75rem;
            color: rgb(107 114 128); /* gray-500 */
            margin-top: 0.5rem;
        }
        .card-meta .sep {
            margin: 0 0.35rem;
            color: rgb(156 163 175); /* gray-400 */
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold text-gray-900">Nailab</h1>
                        <span class="text-gray-400">|</span>
                        <h2 class="text-xl text-gray-600">Founder Features Status</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm text-gray-600">Last Updated: <span id="lastUpdated"></span></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overview Stats -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8 animate-slide-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="flex justify-center mb-2">
                            <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 id="statCompletePercent" class="text-2xl font-bold text-green-600">95%</h3>
                        <p class="text-sm text-gray-600">Complete</p>
                    </div>
                    <div class="text-center">
                        <div class="flex justify-center mb-2">
                            <svg class="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 id="statInProgress" class="text-2xl font-bold text-yellow-600">10</h3>
                        <p class="text-sm text-gray-600">In Progress</p>
                    </div>
                    <div class="text-center">
                        <div class="flex justify-center mb-2">
                            <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                        <h3 id="statMissing" class="text-2xl font-bold text-red-600">4</h3>
                        <p class="text-sm text-gray-600">Missing</p>
                    </div>
                    <div class="text-center">
                        <div class="flex justify-center mb-2">
                            <svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                        </div>
                        <h3 id="statTotal" class="text-2xl font-bold text-blue-600">42</h3>
                        <p class="text-sm text-gray-600">Total Features</p>
                    </div>
                </div>
            </div>

            <!-- Kanban Board -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Completed Column -->
                <div class="bg-green-50 rounded-lg border border-green-200">
                    <div class="p-4 border-b border-green-200">
                        <h3 class="font-semibold text-green-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Completed (<span id="countComplete">28</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="complete">
                        <!-- Authentication & Registration -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Founder Registration & Authentication</h4>
                            <p class="text-sm text-gray-600 mb-2">Email + password sign-up system for founders</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Password Reset</h4>
                            <p class="text-sm text-gray-600 mb-2">Forgot/Reset password functionality with validation</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Email Confirmation</h4>
                            <p class="text-sm text-gray-600 mb-2">Account activation via email confirmation</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <!-- Startup Profile Wizard -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Profile Wizard</h4>
                            <p class="text-sm text-gray-600 mb-2">Step-by-step profile completion with progress</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Personal Information</h4>
                            <p class="text-sm text-gray-600 mb-2">Founder photo, bio, location fields</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Startup Details</h4>
                            <p class="text-sm text-gray-600 mb-2">Name, logo, focus area, description, website</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Professional Background</h4>
                            <p class="text-sm text-gray-600 mb-2">Sector, stage, funding round fields</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Input Validation</h4>
                            <p class="text-sm text-gray-600 mb-2">Required fields validation</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Privacy Controls</h4>
                            <p class="text-sm text-gray-600 mb-2">Manage information visibility</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Save & Exit</h4>
                            <p class="text-sm text-gray-600 mb-2">Save progress during profile completion</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <!-- Dashboard -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Dashboard Access</h4>
                            <p class="text-sm text-gray-600 mb-2">Post-onboarding dashboard with welcome message</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Left Navigation</h4>
                            <p class="text-sm text-gray-600 mb-2">Complete navigation panel with all menu items</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Top Navigation Bar</h4>
                            <p class="text-sm text-gray-600 mb-2">Profile avatar and notification bell</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Welcome Banner</h4>
                            <p class="text-sm text-gray-600 mb-2">Personalized greeting message</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                        
                        <!-- Logout -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Logout Functionality</h4>
                            <p class="text-sm text-gray-600 mb-2">Secure sign-out with session termination</p>
                            <span class="status-badge bg-green-100 text-green-800">‚úÖ Complete</span>
                        </div>
                    </div>
                </div>

                <!-- In Progress Column -->
                <div class="bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="p-4 border-b border-yellow-200">
                        <h3 class="font-semibold text-yellow-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            In Progress (<span id="countInProgress">10</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="in_progress">
                        <!-- Dashboard Overview -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Profile Summary</h4>
                            <p class="text-sm text-gray-600 mb-2">View and edit startup profile data</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Account Settings</h4>
                            <p class="text-sm text-gray-600 mb-2">Update profile and change password</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Progress Tracking</h4>
                            <p class="text-sm text-gray-600 mb-2">View, add, edit milestones and metrics</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Monthly Progress Charts</h4>
                            <p class="text-sm text-gray-600 mb-2">Revenue, customers, runway, burn rate graphs</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <!-- Mentorship -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Recommended Mentors</h4>
                            <p class="text-sm text-gray-600 mb-2">Display mentors based on matching criteria</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">View Mentor Profiles</h4>
                            <p class="text-sm text-gray-600 mb-2">Display mentor information and expertise</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Session Booking</h4>
                            <p class="text-sm text-gray-600 mb-2">Calendar view, time slot selection, confirmation</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <!-- Community -->
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Recommended Founders</h4>
                            <p class="text-sm text-gray-600 mb-2">Display founders based on similarity</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Peer Messaging</h4>
                            <p class="text-sm text-gray-600 mb-2">Peer-to-peer communication system</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Resource Library</h4>
                            <p class="text-sm text-gray-600 mb-2">View, preview, download guides and templates</p>
                            <span class="status-badge bg-yellow-100 text-yellow-800">üü° Partial</span>
                        </div>
                    </div>
                </div>

                <!-- Missing Column -->
                <div class="bg-red-50 rounded-lg border border-red-200">
                    <div class="p-4 border-b border-red-200">
                        <h3 class="font-semibold text-red-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            Missing (<span id="countMissing">4</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="missing">
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Account Deletion</h4>
                            <p class="text-sm text-gray-600 mb-2">Deactivate or delete account functionality</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Calendar Integration</h4>
                            <p class="text-sm text-gray-600 mb-2">Google Calendar sync for mentorship sessions</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">File Attachments</h4>
                            <p class="text-sm text-gray-600 mb-2">Upload business plans, pitch decks for applications</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>
                        
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-1">Advanced Search</h4>
                            <p class="text-sm text-gray-600 mb-2">Advanced filtering for mentors and opportunities</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">Status Legend</h3>
                <p class="text-sm text-gray-600 mb-4">Tip: drag cards between columns (including back). Double-click a card to edit its title/description.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Complete ‚úÖ</p>
                            <p class="text-sm text-gray-600">Feature is fully implemented and functional</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-yellow-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Partial üü°</p>
                            <p class="text-sm text-gray-600">Feature exists but needs enhancements</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Missing ‚ùå</p>
                            <p class="text-sm text-gray-600">Feature is not implemented</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Set last updated date
        document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });

        // Kanban drag/drop + persistence
        document.addEventListener('DOMContentLoaded', function() {
            const STORAGE_KEY = 'nailab_founder_features_board_v1';
            const columns = Array.from(document.querySelectorAll('.kanban-column[data-column]'));
            const cards = Array.from(document.querySelectorAll('.feature-card'));

            function formatDateTime(iso) {
                if (!iso) return '‚Äî';
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return '‚Äî';
                return d.toLocaleString(undefined, {
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function ensureMetaRow(card) {
                let meta = card.querySelector('.card-meta');
                if (meta) return meta;
                meta = document.createElement('div');
                meta.className = 'card-meta';
                meta.innerHTML = '<span class="created">Created: ‚Äî</span><span class="sep">‚Ä¢</span><span class="moved">Moved: ‚Äî</span>';
                card.appendChild(meta);
                return meta;
            }

            function renderCardTimestamps(card) {
                const meta = ensureMetaRow(card);
                const createdEl = meta.querySelector('.created');
                const movedEl = meta.querySelector('.moved');
                if (createdEl) createdEl.textContent = `Created: ${formatDateTime(card.dataset.createdAt)}`;
                if (movedEl) movedEl.textContent = `Moved: ${formatDateTime(card.dataset.movedAt)}`;
            }

            function safeText(str) {
                return (str || '').trim().toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
            }

            function ensureCardIds() {
                const seen = new Set();
                cards.forEach((card, idx) => {
                    if (card.dataset.featureId) return;
                    const title = card.querySelector('h4')?.textContent || `feature-${idx}`;
                    let base = safeText(title) || `feature-${idx}`;
                    let candidate = base;
                    let n = 2;
                    while (seen.has(candidate)) {
                        candidate = `${base}-${n}`;
                        n += 1;
                    }
                    seen.add(candidate);
                    card.dataset.featureId = candidate;
                });
            }

            function setBadgeForColumn(card, columnKey) {
                const badge = card.querySelector('.status-badge');
                if (!badge) return;
                badge.classList.remove(
                    'bg-green-100', 'text-green-800',
                    'bg-yellow-100', 'text-yellow-800',
                    'bg-red-100', 'text-red-800'
                );

                if (columnKey === 'complete') {
                    badge.textContent = '‚úÖ Complete';
                    badge.classList.add('bg-green-100', 'text-green-800');
                } else if (columnKey === 'in_progress') {
                    badge.textContent = 'üü° Partial';
                    badge.classList.add('bg-yellow-100', 'text-yellow-800');
                } else {
                    badge.textContent = '‚ùå Missing';
                    badge.classList.add('bg-red-100', 'text-red-800');
                }
            }

            function updateCounts() {
                const completeCount = document.querySelectorAll('.kanban-column[data-column="complete"] .feature-card').length;
                const inProgressCount = document.querySelectorAll('.kanban-column[data-column="in_progress"] .feature-card').length;
                const missingCount = document.querySelectorAll('.kanban-column[data-column="missing"] .feature-card').length;
                const total = completeCount + inProgressCount + missingCount;

                const pct = total === 0 ? 0 : Math.round((completeCount / total) * 100);

                const elCountComplete = document.getElementById('countComplete');
                const elCountInProgress = document.getElementById('countInProgress');
                const elCountMissing = document.getElementById('countMissing');
                const elStatCompletePercent = document.getElementById('statCompletePercent');
                const elStatInProgress = document.getElementById('statInProgress');
                const elStatMissing = document.getElementById('statMissing');
                const elStatTotal = document.getElementById('statTotal');

                if (elCountComplete) elCountComplete.textContent = String(completeCount);
                if (elCountInProgress) elCountInProgress.textContent = String(inProgressCount);
                if (elCountMissing) elCountMissing.textContent = String(missingCount);

                if (elStatCompletePercent) elStatCompletePercent.textContent = `${pct}%`;
                if (elStatInProgress) elStatInProgress.textContent = String(inProgressCount);
                if (elStatMissing) elStatMissing.textContent = String(missingCount);
                if (elStatTotal) elStatTotal.textContent = String(total);
            }

            function saveBoardState() {
                const state = {};
                columns.forEach(col => {
                    const colKey = col.dataset.column;
                    Array.from(col.querySelectorAll('.feature-card')).forEach(card => {
                        const title = card.querySelector('h4')?.textContent?.trim() || '';
                        const desc = card.querySelector('p')?.textContent?.trim() || '';
                        state[card.dataset.featureId] = {
                            column: colKey,
                            title,
                            desc,
                            createdAt: card.dataset.createdAt || null,
                            movedAt: card.dataset.movedAt || null
                        };
                    });
                });
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                } catch (_) {
                    // ignore storage errors (private mode, quota, etc.)
                }
            }

            function restoreBoardState() {
                let state = null;
                try {
                    state = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
                } catch (_) {
                    state = null;
                }
                if (!state || typeof state !== 'object') return;

                const cardById = new Map(cards.map(c => [c.dataset.featureId, c]));
                const columnByKey = new Map(columns.map(c => [c.dataset.column, c]));

                Object.entries(state).forEach(([id, value]) => {
                    const card = cardById.get(id);
                    if (!card) return;

                    // Backward compatibility: older format stored {id: "column"}
                    const colKey = typeof value === 'string' ? value : value?.column;
                    const col = columnByKey.get(colKey);
                    if (col) {
                        col.appendChild(card);
                        setBadgeForColumn(card, colKey);
                    }

                    if (value && typeof value === 'object') {
                        const titleEl = card.querySelector('h4');
                        const descEl = card.querySelector('p');
                        if (titleEl && typeof value.title === 'string') titleEl.textContent = value.title;
                        if (descEl && typeof value.desc === 'string') descEl.textContent = value.desc;

                        if (typeof value.createdAt === 'string' && value.createdAt) card.dataset.createdAt = value.createdAt;
                        if (typeof value.movedAt === 'string' && value.movedAt) card.dataset.movedAt = value.movedAt;
                    }
                });
            }

            function bootstrapMissingState() {
                // Ensure every card has a createdAt and meta row even before any drag/edit.
                const nowIso = new Date().toISOString();
                let state = null;
                try {
                    state = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
                } catch (_) {
                    state = null;
                }
                if (!state || typeof state !== 'object') state = {};

                let changed = false;
                cards.forEach(card => {
                    ensureMetaRow(card);
                    if (!card.dataset.createdAt) {
                        // Prefer stored value if present; otherwise initialize.
                        const stored = state?.[card.dataset.featureId];
                        if (stored && typeof stored === 'object' && typeof stored.createdAt === 'string' && stored.createdAt) {
                            card.dataset.createdAt = stored.createdAt;
                        } else {
                            card.dataset.createdAt = nowIso;
                            changed = true;
                        }
                    }
                    if (!card.dataset.movedAt) {
                        const stored = state?.[card.dataset.featureId];
                        if (stored && typeof stored === 'object' && typeof stored.movedAt === 'string' && stored.movedAt) {
                            card.dataset.movedAt = stored.movedAt;
                        }
                    }
                    renderCardTimestamps(card);
                });

                if (changed) saveBoardState();
            }

            ensureCardIds();

            // Drag + drop
            cards.forEach(card => {
                card.draggable = true;

                // Make title/desc editable on demand
                const titleEl = card.querySelector('h4');
                const descEl = card.querySelector('p');
                if (titleEl) titleEl.classList.add('editable');
                if (descEl) descEl.classList.add('editable');

                function enableEditing() {
                    card.classList.add('editing');
                    card.draggable = false;
                    if (titleEl) {
                        titleEl.contentEditable = 'true';
                        titleEl.setAttribute('role', 'textbox');
                    }
                    if (descEl) {
                        descEl.contentEditable = 'true';
                        descEl.setAttribute('role', 'textbox');
                    }
                    // focus title first
                    if (titleEl) {
                        const range = document.createRange();
                        range.selectNodeContents(titleEl);
                        const sel = window.getSelection();
                        sel.removeAllRanges();
                        sel.addRange(range);
                        titleEl.focus();
                    }
                }

                function disableEditing(save) {
                    card.classList.remove('editing');
                    if (titleEl) titleEl.contentEditable = 'false';
                    if (descEl) descEl.contentEditable = 'false';
                    card.draggable = true;
                    if (save) {
                        saveBoardState();
                    }
                }

                // Double-click anywhere on the card to edit
                card.addEventListener('dblclick', (e) => {
                    // Avoid triggering edit while dragging
                    if (card.classList.contains('dragging')) return;
                    enableEditing();
                    e.preventDefault();
                });

                // Save on blur (when leaving the card)
                card.addEventListener('focusout', () => {
                    if (!card.classList.contains('editing')) return;
                    // give focus a tick to move between title/desc without exiting edit mode
                    window.setTimeout(() => {
                        const active = document.activeElement;
                        if (card.contains(active)) return;
                        disableEditing(true);
                        renderCardTimestamps(card);
                    }, 0);
                });

                // ESC cancels editing (reverts by reloading from storage snapshot)
                card.addEventListener('keydown', (e) => {
                    if (!card.classList.contains('editing')) return;
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        // restore from saved state
                        restoreBoardState();
                        updateCounts();
                        disableEditing(false);
                    }
                    // prevent Enter from creating new lines in the title
                    if (e.key === 'Enter' && document.activeElement === titleEl) {
                        e.preventDefault();
                        if (descEl) descEl.focus();
                    }
                });

                card.addEventListener('dragstart', (e) => {
                    if (card.classList.contains('editing')) {
                        e.preventDefault();
                        return;
                    }
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', card.dataset.featureId);
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    columns.forEach(c => c.classList.remove('drop-target'));
                });
            });

            columns.forEach(col => {
                col.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    col.classList.add('drop-target');
                });

                col.addEventListener('dragleave', () => {
                    col.classList.remove('drop-target');
                });

                col.addEventListener('drop', (e) => {
                    e.preventDefault();
                    col.classList.remove('drop-target');
                    const id = e.dataTransfer.getData('text/plain');
                    const dragged = document.querySelector(`.feature-card[data-feature-id="${CSS.escape(id)}"]`);
                    if (!dragged) return;

                    col.appendChild(dragged);
                    setBadgeForColumn(dragged, col.dataset.column);
                    dragged.dataset.movedAt = new Date().toISOString();
                    renderCardTimestamps(dragged);
                    dragged.classList.add('just-dropped');
                    window.setTimeout(() => dragged.classList.remove('just-dropped'), 250);
                    updateCounts();
                    saveBoardState();
                });
            });

            restoreBoardState();
            bootstrapMissingState();
            updateCounts();

            // Add animation on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-slide-in');
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.feature-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>